<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css">
    <title>Movie</title>
    <script src="https://kit.fontawesome.com/88b71a012c.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <h1>Filme</h1>
        <input type="text" placeholder="Filme suchen" id="searchmovie">
        <button id="searchBtn"><i class="fa-solid fa-magnifying-glass"></i></button>
        <div id="searchDiv">
            <h2 id="searchheading">Suchergebnisse</h2>
            <div id="moviesearch" class="movie-row"></div>
        </div>
        <div id="movie1">
            <h2>Filme nach J.R.R. Tolkien</h2>
            <div id="movierow-1" class="movie-row"></div>
        </div>
        <div id="movie2">
            <h2>Filme nach Stephen King</h2>
            <div id="movierow-2" class="movie-row"></div>
        </div>
        <div id="movie3">
            <h2>Star Trek - Universum</h2>
            <div id="movierow-3" class="movie-row"></div>
        </div>
        <div id="watchlist-row">
            <h2>Deine Watchlist</h2>
            <div id="watchlist-cards" class="movie-row"></div>
        </div>
    </div>

    <script>
        const movieIds = [
            [
                "tt0120737",
                "tt0167261",
                "tt0167260",
                "tt0903624",
                "tt1170358",
                "tt2310332",
            ],
            [
                "tt0108941",
                "tt0099864",
                "tt1212452",
                "tt0120689",
                "tt0109642",
                "tt0118460",
            ],
            [
                "tt0079945",
                "tt0084726",
                "tt0088170",
                "tt0092007",
                "tt0098382",
                "tt0102975",
            ],
        ];

        document.addEventListener("DOMContentLoaded", function () {
            // --- Watchlist Funktionen ---
            function getWatchlist() {
                return JSON.parse(localStorage.getItem("watchlist") || "[]");
            }
            function saveWatchlist(list) {
                localStorage.setItem("watchlist", JSON.stringify(list));
            }
            function toggleWatchlist(id) {
                let list = getWatchlist();
                if (list.includes(id)) {
                    list = list.filter(x => x !== id);
                } else {
                    list.push(id);
                }
                saveWatchlist(list);
                renderWatchlist();
                loadAllRows();
            }
            function isInWatchlist(id) {
                return getWatchlist().includes(id);
            }
            function animateHeart(el) {
                el.classList.add("animate-heart");
                setTimeout(() => el.classList.remove("animate-heart"), 300);
            }

            // --- Kartenfunktion ---
            async function renderCards(container, ids) {
                let cardsHtml = "";
                for (const id of ids) {
                    try {
                        const response = await fetch(`https://www.omdbapi.com/?i=${id}&apikey=d66efe54`);
                        const movie = await response.json();
                        const heartClass = isInWatchlist(id) ? "fa-solid" : "fa-regular";
                        cardsHtml += `
                    <div class="card">
                        <h4>
                            ${movie.Title}
                            <i class="fa-heart ${heartClass} heart-icon" data-id="${id}"></i>
                        </h4>
                        <div class="img-container">
                            <img src="${movie.Poster}" alt="Poster" class="card-img">
                            <div class="plot">${movie.Plot}</div>
                        </div>
                    </div>
                `;
                    } catch (e) { }
                }
                container.innerHTML = cardsHtml;
                container.querySelectorAll(".heart-icon").forEach(icon => {
                    icon.onclick = function () {
                        animateHeart(this);
                        toggleWatchlist(this.dataset.id);
                    };
                });
            }

            // --- Watchlist anzeigen ---
            function renderWatchlist() {
                const list = getWatchlist();
                const row = document.getElementById("watchlist-row");
                const cards = document.getElementById("watchlist-cards");
                if (list.length === 0) {
                    row.style.display = "none";
                    cards.innerHTML = "";
                    return;
                }
                row.style.display = "block";
                renderCards(cards, list);
            }

            // --- Hauptreihen laden ---
            async function loadAllRows() {
                for (let row = 0; row < movieIds.length; row++) {
                    const container = document.getElementById(`movierow-${row + 1}`);
                    await renderCards(container, movieIds[row]);
                }
                renderWatchlist();
            }

            // --- Initiales Laden ---
            loadAllRows();

            // --- Suchfunktion ---
            const searchInput = document.getElementById("searchmovie");
            const searchBtn = document.getElementById("searchBtn");
            const searchDiv = document.getElementById("moviesearch");
            const searchHeading = document.getElementById("searchheading");
            const searchContainer = document.getElementById("searchDiv");

            // Anfangs ausblenden
            searchContainer.style.display = "none";
            searchHeading.style.display = "none";
            searchDiv.innerHTML = "";

            searchBtn.addEventListener("click", async function () {
                const query = searchInput.value.trim();
                if (!query) {
                    searchContainer.style.display = "none";
                    searchHeading.style.display = "none";
                    searchDiv.innerHTML = "";
                    return;
                }

                // Spinner anzeigen
                searchDiv.innerHTML = `<i class="fa-solid fa-spinner my-spinner"></i>`;
                searchContainer.style.display = "block";
                searchHeading.style.display = "block";

                // OMDb-API Suche
                const response = await fetch(`https://www.omdbapi.com/?s=${encodeURIComponent(query)}&apikey=d66efe54`);
                const data = await response.json();

                if (data.Search && data.Search.length > 0) {
                    let cardsHtml = "";
                    for (const movie of data.Search) {
                        try {
                            // Detaildaten für Plot
                            const detailResponse = await fetch(`https://www.omdbapi.com/?i=${movie.imdbID}&apikey=d66efe54`);
                            const detail = await detailResponse.json();
                            const heartClass = isInWatchlist(movie.imdbID) ? "fa-solid" : "fa-regular";
                            cardsHtml += `
                        <div class="card">
                            <h4>
                                ${detail.Title}
                                <i class="fa-heart ${heartClass} heart-icon" data-id="${movie.imdbID}"></i>
                            </h4>
                            <div class="img-container">
                                <img src="${detail.Poster}" alt="Poster" class="card-img">
                                <div class="plot">${detail.Plot}</div>
                            </div>
                        </div>
                    `;
                        } catch (e) { }
                    }
                    searchDiv.innerHTML = cardsHtml;
                    // Herz-EventListener & Animation für Suchergebnisse
                    searchDiv.querySelectorAll(".heart-icon").forEach(icon => {
                        icon.onclick = function () {
                            animateHeart(this);
                            toggleWatchlist(this.dataset.id);
                        };
                    });
                }
            });
        });

    </script>
</body>

</html>